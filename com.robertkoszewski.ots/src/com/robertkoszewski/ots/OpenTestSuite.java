package com.robertkoszewski.ots;

import java.util.Map;

import org.osgi.framework.BundleContext;
import org.osgi.service.component.ComponentContext;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Deactivate;
import org.osgi.service.component.annotations.Reference;

import com.robertkoszewski.utils.splashscreen.api.SplashScreenManager;

@Component(name = "OpenTestSuite")
public class OpenTestSuite{
	
	// Static Variables
	String[] 		args;
	static Thread 	main_thread = null;
	
	/**
	 * Parse Args
	 * @param object
	 * @param map
	 */
	@Reference(target="(launcher.arguments=*)")
	void args(Object object, Map<String,Object> map) {
	       args = (String[]) map.get("launcher.arguments");
	       System.out.println("Args2: " + args.length);
	 }
	
	@Activate
	void activate(BundleContext ctx) { 
		// ComponentContext ctx
		System.out.println("+ Activating OpenTestSuite.Core");
		
		if(main_thread == null) {
			main_thread = new Thread(){
				
				@Override
				public void run() {
					System.out.println("Main Thread Started ++++");
					// Load Splash Manager
					// Load APP Basic Configuration
					// Load Args Parser
					// Start Logger Services (?)
					// Initialize GUI/Console/Server-Mode
				}
				
			};
			
			main_thread.start();
		}
		
		//ctx.getAllServiceReferences(".", "")
		
		/*
		Object o = ctx.getServiceReference(SplashScreenManager.class.getName());
		System.out.println("OBJECT:  "+o);*/
		
		try {
			Thread.sleep(500);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		
		
		
		//ServiceReference<SplashScreenManager> s = (ServiceReference<SplashScreenManager>) ctx.getServiceReference(SplashScreenManager.class.getName());
		SplashScreenManager s = (SplashScreenManager) ctx.getService(ctx.getServiceReference(SplashScreenManager.class.getName()));
		s.updateSplashMessage("Message 2");
		
		/*
		SplashScreenManager splash = 
				(SplashScreenManager) ctx.getServiceReference
				(SplashScreenManager.class.getName());
		System.out.println("SERVICE: "+splash);
		splash.updateSplashMessage("TEST SPLASH MESSAGE");*/
	}	
	
	@Deactivate
	void deactivate(ComponentContext ctx) {
		System.out.println("- Deactivating OpenTestSuite.Core");
		if(main_thread != null) {
			main_thread.interrupt();
			main_thread = null;
		}
	}
	
}
